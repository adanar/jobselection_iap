<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-CA">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-CA">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-CA">
<!--<![endif]-->
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>Representative Notified | Job Selection</title>
	<link rel="profile" href="http://gmpg.org/xfn/11">
	<link rel="pingback" href="http://stork-ap.aegean.gr/JobSelection/xmlrpc.php">
	<!--[if lt IE 9]>
	<script src="http://stork-ap.aegean.gr/JobSelection/wp-content/themes/twentythirteen/js/html5.js"></script>
	<![endif]-->
	<link rel="alternate" type="application/rss+xml" title="Job Selection &raquo; Feed" href="http://stork-ap.aegean.gr/JobSelection/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="Job Selection &raquo; Comments Feed" href="http://stork-ap.aegean.gr/JobSelection/?feed=comments-rss2" />
<link rel="alternate" type="application/rss+xml" title="Job Selection &raquo; Employee&#8217;s Registration Comments Feed" href="http://stork-ap.aegean.gr/JobSelection/?feed=rss2&#038;page_id=4" />
<link rel='stylesheet' id='open-sans-css'  href='//fonts.googleapis.com/css?family=Open+Sans%3A300italic%2C400italic%2C600italic%2C300%2C400%2C600&#038;subset=latin%2Clatin-ext&#038;ver=4.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='dashicons-css'  href='http://stork-ap.aegean.gr/JobSelection/wp-includes/css/dashicons.min.css?ver=4.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='admin-bar-css'  href='http://stork-ap.aegean.gr/JobSelection/wp-includes/css/admin-bar.min.css?ver=4.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='twentythirteen-fonts-css'  href='//fonts.googleapis.com/css?family=Source+Sans+Pro%3A300%2C400%2C700%2C300italic%2C400italic%2C700italic%7CBitter%3A400%2C700&#038;subset=latin%2Clatin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='genericons-css'  href='http://stork-ap.aegean.gr/JobSelection/wp-content/themes/twentythirteen/genericons/genericons.css?ver=3.03' type='text/css' media='all' />
<link rel='stylesheet' id='twentythirteen-style-css'  href='http://stork-ap.aegean.gr/JobSelection/wp-content/themes/twentythirteen/style.css?ver=2013-07-18' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentythirteen-ie-css'  href='http://stork-ap.aegean.gr/JobSelection/wp-content/themes/twentythirteen/css/ie.css?ver=2013-07-18' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='http://stork-ap.aegean.gr/JobSelection/wp-includes/js/jquery/jquery.js?ver=1.11.1'></script>
<script type='text/javascript' src='http://stork-ap.aegean.gr/JobSelection/wp-includes/js/jquery/jquery-migrate.min.js?ver=1.2.1'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://stork-ap.aegean.gr/JobSelection/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://stork-ap.aegean.gr/JobSelection/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.1.1" />
<link rel='canonical' href='http://stork-ap.aegean.gr/JobSelection/?page_id=4' />
<link rel='shortlink' href='http://stork-ap.aegean.gr/JobSelection/?p=4' />
<link rel='https://github.com/WP-API/WP-API' href='http://stork-ap.aegean.gr/JobSelection/?json_route=/' />
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
	<style type="text/css" id="twentythirteen-header-css">
			.site-header {
			background: url(http://stork-ap.aegean.gr/JobSelection/wp-content/themes/twentythirteen/images/headers/logo3.jpg) no-repeat scroll right;
			background-size: 800px 230px;
			border-top: solid 2px rgb(157, 17, 17);
			border-bottom: solid 2px rgb(157, 17, 17);
		}
		@media (max-width: 767px) {
			.site-header {
				background-size: 768px auto;
			}
		}
		@media (max-width: 359px) {
			.site-header {
				background-size: 360px auto;
			}
		}
		</style>
	<style type="text/css" media="print">#wpadminbar { display:none; }</style>
<style type="text/css" media="screen">
	html { margin-top: 32px !important; }
	* html body { margin-top: 32px !important; }
	@media screen and ( max-width: 782px ) {
		html { margin-top: 46px !important; }
		* html body { margin-top: 46px !important; }
	}
</style>
</head>

<body class="page page-id-4 page-template-default logged-in admin-bar no-customize-support single-author">
	<div id="page" class="hfeed site">
		<header id="masthead" class="site-header" role="banner">
			<a class="home-link" href="http://stork-ap.aegean.gr/JobSelection/home.php" title="Job Selection" rel="home">
				<h1 class="site-title">Job Selection</h1>
				<h2 class="site-description">Internship Application Platform</h2>
			</a>

			
		</header><!-- #masthead -->

		<div id="main" class="site-main">

	<div id="primary" class="content-area">
		<div id="content" class="site-content" role="main">

						
				<article id="post-4" class="post-4 page type-page status-publish hentry">
					<header class="entry-header">
						
						<h1 class="entry-title">Representative Notified</h1>
					</header><!-- .entry-header -->

					<div class="entry-content">

<?php
//line 97: Gets the emp_system_t variable value
$emp_system_t= $_GET["t"];

//lines 100-106: Informs the user-employee about finishing his registration process steps
echo "<p>The notification mail has been succefully sent to the company's representative.</p>";
echo "<p>If you wish, you can go back to the \"Home\" page by clicking on the \"Home page\" button.</p><br/>";
echo "<form action='home.php' method='post' name='redirect_to_home'>";
	echo "<table>";
		echo "<tr> <input type='submit' value='Home page' /> </tr>";
	echo "</table>";
echo "</form>";

//lines 109-113: Establish database connection
$con = mysqli_connect("localhost","root","fcD6EGaTQsp6LXC9","JobSelection"); 
//on connection failure, throw an error
if(!$con) {  
die('Could not connect: '.mysql_error()); 
} 

//lines 116-156: Selects all the needed information needed to be attached in the representative's notification email
require_once('wp-config.php');

$sql1= "SELECT representative_token FROM user_connection WHERE employee_token='".$emp_system_t ."'";
$sql1_result= mysqli_query($con, $sql1);

if ($sql1_result->num_rows ==1){
	$row = $sql1_result->fetch_assoc();
	$rep_system_t= $row["representative_token"];
}

require_once('wp-config.php');
$sql2 = "SELECT * FROM wp_users WHERE token='". $rep_system_t ."'";

		$sql2_result= mysqli_query($con,$sql2); 
		

		if ($sql2_result->num_rows ==1){
			$row = $sql2_result->fetch_assoc();
			$rep_email= $row["user_email"];
			$rep_name = $row["name"];
			$rep_surname = $row["surname"];
			
		}
		
require_once('wp-config.php');
$sql3 = "SELECT * FROM user_connection WHERE employee_token='". $emp_system_t ."'";
$sql3_result= mysqli_query($con, $sql3);

if ($sql3_result->num_rows ==1){
	$row = $sql3_result->fetch_assoc();
	$company_token= $row["company_token"];
}

require_once('wp-config.php');
$sql4 = "SELECT company_name FROM companies WHERE token='". $company_token ."'";
$sql4_result= mysqli_query($con,$sql4);

if ($sql4_result->num_rows ==1){
	$row = $sql4_result->fetch_assoc();
	$company_name= $row["company_name"];
}
		
//lines 159-173: Prepare and send the representative notification email
if(isset($rep_email)){
	$msg .= "Dear $rep_name $rep_surname, \n";
	$msg .= "A registration request has been applied from an employee of the company $company_name. \n\n";
	$msg .= "Please follow the link below, in order to continue with the registration process. \n";
	$msg .= "http://stork-ap.aegean.gr/JobSelection/registration_info.php?t=" .$rep_system_t;
	$msg .= "\n\n Instructions are provided to help you finalize the company's registration. \n\n";
	$msg .= "With regards, \n the Internship Application Platform Team";
	$headers="";
	$opts = '-F"Internship Apllication Platform - UAegean"';
	
	mail($rep_email, 'Company`s Registration - Internship Application Platform', $msg, $headers, $opts);
	
}else{
	header("Location: http://stork-ap.aegean.gr/JobSelection/process_failed.php"); 
}


?>

</div><!-- .entry-content -->

					


		</div><!-- #main -->
		
	</div><!-- #page -->

	<script type='text/javascript' src='http://stork-ap.aegean.gr/JobSelection/wp-includes/js/admin-bar.min.js?ver=4.1.1'></script>
<script type='text/javascript' src='http://stork-ap.aegean.gr/JobSelection/wp-includes/js/comment-reply.min.js?ver=4.1.1'></script>
<script type='text/javascript' src='http://stork-ap.aegean.gr/JobSelection/wp-includes/js/masonry.min.js?ver=3.1.2'></script>
<script type='text/javascript' src='http://stork-ap.aegean.gr/JobSelection/wp-includes/js/jquery/jquery.masonry.min.js?ver=3.1.2'></script>
<script type='text/javascript' src='http://stork-ap.aegean.gr/JobSelection/wp-content/themes/twentythirteen/js/functions.js?ver=2014-06-08'></script>
	<script type="text/javascript">
		(function() {
			var request, b = document.body, c = 'className', cs = 'customize-support', rcs = new RegExp('(^|\\s+)(no-)?'+cs+'(\\s+|$)');

			request = true;

			b[c] = b[c].replace( rcs, ' ' );
			b[c] += ( window.postMessage && request ? ' ' : ' no-' ) + cs;
		}());
	</script>
			

		</body>
</html>